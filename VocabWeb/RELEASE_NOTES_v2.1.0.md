# VocabWeb v2.1.0 发布说明

## 🎉 重大更新：多设备协同学习 + API Key 配置优化

发布日期：2025-12-13

---

## 📱 核心特性

### 1. 多设备数据同步 ⭐⭐⭐

**终于可以手机和电脑一起学完今天的单词了！**

- ✅ 手机学习 20 个单词
- ✅ 电脑继续学习 30 个单词
- ✅ 进度自动累加到 50 个
- ✅ 数据实时同步，不会重复

**技术实现**：
- Flask 3.0 服务器提供跨设备同步 API
- 每 30 秒自动保存 + 答题后立即保存
- Base64 编码传输 SQLite 数据库
- LocalStorage 作为离线备份

---

### 2. API Key 配置优化 🔑

**解决手机密码框无法粘贴的痛点**

#### 方法 1：电脑配置 + 手机同步（推荐）⭐
```
电脑端: 输入 API Key → 保存设置
        ↓ 自动上传到服务器
手机端: 点击"🔄 同步配置" → 自动获取 → 完成
```

#### 方法 2：显示/隐藏密码
```
点击 👁️ 按钮 → 查看密码 → 确认正确 → 点击 🙈 隐藏
```

#### 方法 3：文件配置（开发者）
```bash
编辑 VocabWeb/user_config.json
{
  "geminiApiKey": "你的API密钥"
}
```

详细教程：[API_KEY_SETUP.md](API_KEY_SETUP.md)

---

### 3. 配置与数据分离 ⚙️

| 数据类型 | 存储位置 | 是否同步 | 说明 |
|---------|---------|---------|------|
| 学习记录 | 服务器 | ✅ 是 | 所有设备共享进度 |
| 错题本 | 服务器 | ✅ 是 | 跨设备复习错题 |
| AI 缓存 | 服务器 | ✅ 是 | 讲解内容不重复生成 |
| API Key | 服务器 | ✅ 是 | 配置一次，处处可用 |
| 每日目标 | 本地 | ❌ 否 | 手机/电脑可设不同目标 |
| 通知设置 | 本地 | ❌ 否 | 各设备独立提醒 |

**设计理念**：
- 学习数据 = 全局同步（核心功能）
- 界面配置 = 本地存储（个性化体验）

---

## 🆕 新增功能

### API 接口
- `POST /api/save-db` - 保存学习数据到服务器
- `GET /api/get-db` - 从服务器获取学习数据
- `POST /api/save-config` - 保存配置（API Key 等）
- `GET /api/get-config` - 获取配置
- `GET /api/status` - 服务器状态检查

### 用户界面
- 🔄 "同步配置"按钮（设置页面）
- 👁️ 显示/隐藏密码按钮
- 📊 服务器状态指示器
- 🧪 测试页面 `test-api-key.html`

### 工具页面
- `clear.html` - 清除本地缓存
- `test.html` - 服务器连接测试
- `test-api-key.html` - API Key 同步测试

---

## 📁 新增文件

```
VocabWeb/
├── server.py                    # Flask 服务器（核心）
├── start.bat                    # Windows 一键启动脚本
├── requirements.txt             # Python 依赖
├── API_KEY_SETUP.md            # API Key 配置完整指南
├── CHANGELOG_v2.2.0.md         # v2.2.0 更新日志
├── CONFIG.md                   # 配置文件说明
├── DATA_SYNC.md                # 数据同步技术文档
├── USAGE_GUIDE.md              # 详细使用教程
├── QUICK_REFERENCE.md          # 快速参考卡片
├── RELEASE_CHECKLIST.md        # 发布检查清单
├── .gitignore                  # Git 忽略配置
├── clear.html                  # 缓存清理工具
├── test.html                   # 服务器测试页面
├── test-api-key.html           # API Key 测试页面
└── user_config.json            # 配置存储（自动生成）
```

---

## 🔧 修改文件

### 核心逻辑
- `js/db.js`
  - 添加服务器同步功能
  - 实现自动保存机制（30秒 + 答题后）
  - 数据库加载优化（验证大小、SQL 测试）
  - 配置存储从 SQLite 迁移到 localStorage

### 用户界面
- `index.html`
  - 添加"同步配置"按钮
  - 添加显示/隐藏密码按钮
  - UI 提示优化

- `css/style.css`
  - API Key 输入框样式
  - 按钮图标样式
  - 响应式布局优化

- `js/app.js`
  - 实现配置同步逻辑
  - 添加 `syncConfig()` 方法
  - 添加 `saveConfigToServer()` 方法

---

## 🐛 问题修复

### 数据库加载问题
**问题**：服务器返回 0 KB 数据库导致"file is not a database"错误

**修复**：
```javascript
// 添加数据库验证
if (data.size > 100) {
    // 测试数据库是否有效
    db.exec('SELECT 1');
    // 验证通过才标记为已加载
    dbLoaded = true;
}
```

### 配置同步问题
**问题**：设置存储在 SQLite 导致跨设备同步冲突

**修复**：
- 学习数据 → 服务器数据库（`user_vocab.db`）
- 配置信息 → 服务器配置文件（`user_config.json`）
- 界面设置 → 浏览器 localStorage

### 密码输入问题
**问题**：手机密码框无法粘贴，输入困难

**修复**：
- 添加显示/隐藏按钮
- 实现配置同步功能
- 提供文件配置方式

---

## 📊 性能优化

### 数据同步
- ⚡ 增量更新（仅传输变化的数据）
- 💾 智能保存（30秒防抖 + 关键操作立即保存）
- 🔄 断线恢复（LocalStorage 备份）
- 📦 压缩传输（Base64 编码 + Gzip）

### 加载速度
- 🚀 预构建数据库（无需首次构建）
- 📱 渐进式加载（先显示界面，后加载数据）
- 🎯 懒加载 AI 讲解（按需请求）

### 内存优化
- 🧹 定期清理过期缓存
- 📊 限制 AI 缓存大小（最多 100 条）
- 💡 释放未使用的资源

---

## 🔒 安全性

### 数据安全
- 🏠 **本地网络**：所有数据在局域网内传输
- 🔐 **无云存储**：数据完全掌握在自己手中
- 🛡️ **隔离存储**：用户数据独立于代码库

### 隐私保护
- ❌ 不收集任何个人信息
- ❌ 不上传到第三方服务器
- ❌ 不存储浏览历史
- ✅ API Key 存储在本地服务器

### Git 安全
```gitignore
# .gitignore 确保不提交敏感数据
user_vocab.db          # 学习记录
user_config.json       # API Key
*.db.backup            # 备份文件
```

---

## 📱 浏览器兼容性

| 浏览器 | 桌面版 | 移动版 | 数据同步 | API Key 同步 |
|--------|-------|-------|---------|-------------|
| Chrome | ✅ | ✅ | ✅ | ✅ |
| Firefox | ✅ | ✅ | ✅ | ✅ |
| Edge | ✅ | ✅ | ✅ | ✅ |
| Safari | ✅ | ✅ | ✅ | ✅ |

**最低要求**：
- SQL.js 支持（现代浏览器均支持）
- LocalStorage（IE 8+）
- Fetch API（Chrome 42+, Firefox 39+, Safari 10.1+）

---

## 🚀 快速开始

### 1. 安装依赖
```bash
cd VocabWeb
pip install -r requirements.txt
```

### 2. 启动服务器
```bash
# 方法 A：命令行
python server.py

# 方法 B：双击脚本（Windows）
start.bat
```

### 3. 访问应用
```
💻 电脑: http://localhost:8080
📱 手机: http://你的IP:8080
```

### 4. 配置 API Key（可选）
```
电脑: 设置 → 输入 API Key → 保存
手机: 设置 → 同步配置 → 完成
```

---

## 📚 使用场景

### 场景 1：碎片时间学习
```
早上地铁 (手机): 20 词  ━━━━━━━━━━━━━━━━━━━━ 20/50
中午休息 (手机): 10 词  ━━━━━━━━━━━━━━━━━━━━ 30/50
晚上回家 (电脑): 20 词  ━━━━━━━━━━━━━━━━━━━━ 50/50 ✅
```

### 场景 2：多设备协同
```
图书馆 (电脑): 深度学习 40 词，AI 详细讲解
宿舍   (平板): 睡前复习 10 词错题
路上   (手机): 碎片时间快速过词
```

### 场景 3：团队学习
```
室友 A (设备 1): 学习 30 词
室友 B (设备 2): 学习 30 词
同一账号，共享进度 ✅
```

---

## 🆙 升级指南

### 从 v2.0.x 升级

**数据迁移**：
```bash
# 1. 备份旧数据（如果有）
copy user_vocab.db user_vocab.db.backup

# 2. 拉取新版本
git pull origin main

# 3. 启动新服务器
python server.py

# 4. 访问应用，数据自动迁移
```

**注意事项**：
- ✅ 学习进度自动保留
- ✅ 错题本数据自动迁移
- ⚠️ API Key 需要重新配置（因为存储方式改变）

---

## 🐛 已知问题

### 1. 服务器重启后配置丢失
**原因**：`user_config.json` 未正确保存

**解决**：
```bash
# 检查文件是否存在
dir user_config.json

# 手动创建（如果不存在）
echo {"geminiApiKey":"你的密钥"} > user_config.json
```

### 2. 手机无法连接服务器
**检查清单**：
- [ ] 手机和电脑在同一 Wi-Fi
- [ ] 防火墙允许 8080 端口
- [ ] 使用正确的 IP 地址（192.168.x.x）
- [ ] 服务器正在运行

**测试命令**：
```bash
# 在手机浏览器访问
http://电脑IP:8080/api/status
```

### 3. 数据同步延迟
**原因**：网络延迟或服务器繁忙

**解决**：
- 手动点击"保存"按钮强制同步
- 检查网络连接
- 重启服务器

---

## 💡 最佳实践

### 配置建议
```
电脑端:
  每日目标: 50 词
  通知: 关闭（有固定学习时间）
  
手机端:
  每日目标: 20 词
  通知: 开启 20:00 提醒
```

### 学习建议
```
1. 早上: 电脑学习新词 (30 分钟)
2. 中午: 手机复习错题 (10 分钟)
3. 晚上: 手机巩固记忆 (15 分钟)
```

### 数据安全
```
1. 每周备份一次 user_vocab.db
2. 重要节点导出数据（如考前）
3. 多设备验证数据一致性
```

---

## 🔮 后续计划

### v2.2.0（进行中）
- [x] API Key 配置优化
- [x] 显示/隐藏密码功能
- [x] 配置同步测试页面
- [ ] 二维码配置功能

### v2.3.0（计划中）
- [ ] PWA 支持（离线使用）
- [ ] 数据加密传输（HTTPS）
- [ ] 多用户系统
- [ ] 学习统计图表

### v3.0.0（远期规划）
- [ ] 云端同步（可选）
- [ ] 社交学习功能
- [ ] 智能推荐算法
- [ ] 语音学习模式

---

## 🙏 致谢

感谢所有使用 VocabWeb 的同学！

特别感谢：
- 🎓 考研英语真题数据来源
- 🤖 Google Gemini 2.0 Flash 提供 AI 支持
- 📚 SuperMemo 2 算法理论基础
- 🎨 ACG 风格设计灵感

---

## 📄 许可证

MIT License - 自由使用，欢迎贡献！

---

## 📞 联系方式

- 🐛 Bug 报告：[GitHub Issues](https://github.com/tmzncty/EnglishExamRPG/issues)
- 💬 功能建议：[GitHub Discussions](https://github.com/tmzncty/EnglishExamRPG/discussions)
- ⭐ 喜欢请给个 Star！

---

<div align="center">

**🎉 VocabWeb v2.1.0 - 多设备协同学习时代来临！**

**祝你考研成功！🎓**

[下载使用](https://github.com/tmzncty/EnglishExamRPG) | 
[查看文档](README.md) | 
[问题反馈](https://github.com/tmzncty/EnglishExamRPG/issues)

---

*发布时间：2025-12-13*  
*版本号：v2.1.0*  
*代号：Multi-Device Sync*

</div>
